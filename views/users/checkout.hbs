<body>
	<section class="hero-wrap hero-wrap-2" style="background-image: url(/banner-images/{{banner.[0]._id}}.jpg);"
		data-stellar-background-ratio="0.5">
		<div class="overlay"></div>
		<div class="container">
			<div class="row no-gutters slider-text align-items-end justify-content-center">
				<div class="col-md-9 ftco-animate mb-5 text-center">
					<p class="breadcrumbs mb-0"><span class="mr-2"><a href="/">Home <i
									class="fa fa-chevron-right"></i></a></span> <span>Checkout <i
								class="fa fa-chevron-right"></i></span></p>
					<h2 class="mb-0 bread">Checkout</h2>
				</div>
			</div>
		</div>
	</section>

	<section class="ftco-section">
		<div class="container">
			<div class="row justify-content-center">
				<div class="col-xl-10 ftco-animate">
					<form action="/placeOrder" id="checkoutForm" class="billing-form">
						<h3 class="mb-4 billing-heading">Billing Details</h3>
						<div class="row align-items-end">
							<div class="col-md-6">
								<div class="form-group">
									<label for="fullname">Full Name</label>
									<input type="text" class="form-control" placeholder="" id="name" name="name"
										required>
								</div>
							</div>
							<div class="col-md-6">
								<div class="form-group">
									<label for="Building Name">Building Name</label>
									<input type="text" class="form-control" placeholder="" id="buildingName"
										name="buildingname" required>
								</div>
							</div>
							<div class="w-100"></div>

							<div class="w-100"></div>
							<div class="col-md-6">
								<div class="form-group">
									<label for="towncity">Town / City</label>
									<input type="text" class="form-control" placeholder="" id="city" name="city"
										required>
								</div>
							</div>
							<div class="col-md-6">
								<div class="form-group">
									<label for="postcodezip">Postcode / ZIP *</label>
									<input type="number" class="form-control" name="postcode" id="postcode" required>
								</div>
							</div>
							<div class="w-100"></div>
							<div class="col-md-6">
								<div class="form-group">
									<label for="phone">Phone</label>
									<input type="number" class="form-control" placeholder="" id="phone" name="phone"
										required>
									<input type="text" name="userId" value="{{user._id}}" hidden>
								</div>
							</div>
							<div class="col-md-6">
								<div class="form-group">
									<label for="emailaddress">Email Address</label>
									<input type="email" id="email" class="form-control" placeholder="" name="email"
										required>
								</div>
							</div>
							<div class="w-100"></div>
							<div class="col-md-12">
								<div class="form-group mt-4">
									<div class="radio">

										<div id="accordion">
											{{#each userAddress.address}}

											<div class="card">
												<div class="card-header">
													<a class="card-link text-primary font-weight-bold"
														data-toggle="collapse" href="#collapseOne">
														<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
															fill="currentColor" class="bi bi-bookmarks-fill"
															viewBox="0 0 16 16">
															<path
																d="M2 4a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v11.5a.5.5 0 0 1-.777.416L7 13.101l-4.223 2.815A.5.5 0 0 1 2 15.5V4z" />
															<path
																d="M4.268 1A2 2 0 0 1 6 0h6a2 2 0 0 1 2 2v11.5a.5.5 0 0 1-.777.416L13 13.768V2a1 1 0 0 0-1-1H4.268z" />
														</svg>
														<span class="font-weight-bold text-dark ml-3">Address {{inc
															@index}}</span>
													</a>
												</div>
												<div id="collapseOne" class="collapse " data-parent="#accordion">
													<div class="card-body">
														<input type="radio" class="mr-2" name="choice"
															onclick="savedAddressSelect('{{this.name}}','{{this.phone}}','{{this.buildingName}}','{{this.city}}','{{this.postcode}}','{{this.email}}')"
															id="useAddress">>
														<p class="text-dark">{{this.name}},<br>
															{{this.phone}}<br>
															{{this.email}},<br>
															{{this.buildingName}},
															{{this.city}},
															{{this.postcode}}</p>
													</div>
												</div>
											</div>
											{{/each}}



										</div>



									</div>
								</div>
							</div>





							<div class="row mt-5 pt-3 d-flex" id="price">
								<div class="col-md-6 d-flex">
									<div class="cart-detail cart-total p-3 p-md-4">
										<h3 class="billing-heading mb-4">Your Orders</h3>
										<h5 class="">Products</h5>
										{{#each products.cartItems}}
										<p class="d-flex">
											<span>{{this.product.name}}({{this.quantity}})</span>
											<span>Rs {{this.productTotal}}</span>
										</p>
										{{/each}}
										<hr>
										<h3 class="billing-heading mb-4">Cart Total</h3>
										<p class="d-flex">
											<span>Subtotal</span>
											<span>₹ {{totalAmount}}</span>
											
										</p>
										<p class="d-flex">
											<span>Delivery</span>
											<span>100</span>
										</p>
										
										<p class="d-flex">
											<span>Discount</span>
											₹<span id="discount">{{discountPrice}}</span>
										</p>
										<hr>
										{{#if discountPrice}}
										<p class="d-flex total-price">
											<span>Total</span>
											<span> ₹ {{subtotal coupendiscount 100}} </span>
											<input id="GrandTotal" name="GrandTotal" type="number" value="{{subtotal coupendiscount 100}}" hidden>
										</p>
										{{else}}
										<p class="d-flex total-price">
											<span>Total</span>
											<span> ₹ {{subtotal totalAmount 100}}</span>
											 <input id="GrandTotal" name="GrandTotal" type="number" value="{{subtotal totalAmount 100}}" hidden>
										</p>
										{{/if}}
									</div>
								</div>
								<div class="col-md-6">
									<div class="cart-detail p-3 p-md-4">
										<h3 class="billing-heading mb-4">Payment Method</h3>
										<div class="form-group">
											<div class="col-md-12">
												<div class="radio">
													<label><input type="radio" class="mr-2" name="payment-method"
															value="COD">Cash on
														Delivery</label>
												</div>
											</div>
										</div>

										<div class="form-group">
											<div class="col-md-12">
												<div class="radio">
													<label><input type="radio" class="mr-2" name="payment-method"
															value="ONLINE">Online Payment</label>
												</div>
											</div>
										</div>
										<div class="form-group">
											<div class="col-md-12">
												<div class="checkbox">
													<label><input type="checkbox" value="" class="mr-2" required> I have
														read and
														accept
														the terms and conditions</label>
												</div>
											</div>
										</div>
										<button type="submit" class="btn btn-primary py-3 px-4">Place an
											order</button>
									</div>
								</div>
							</div>
					</form><!-- END -->
					




				</div> <!-- .col-md-8 -->
			</div>
		</div>
	</section>

	<footer class="ftco-footer">
		<div class="container">
			<div class="row mb-5">
				<div class="col-sm-12 col-md">
					<div class="ftco-footer-widget mb-4">
						<h2 class="ftco-heading-2 logo"><a href="#">Liquor <span>Store</span></a></h2>
						<p>Far far away, behind the word mountains, far from the countries.</p>
						<ul class="ftco-footer-social list-unstyled mt-2">
							<li class="ftco-animate"><a href="#"><span class="fa fa-twitter"></span></a></li>
							<li class="ftco-animate"><a href="#"><span class="fa fa-facebook"></span></a></li>
							<li class="ftco-animate"><a href="#"><span class="fa fa-instagram"></span></a></li>
						</ul>
					</div>
				</div>
				<div class="col-sm-12 col-md">
					<div class="ftco-footer-widget mb-4 ml-md-4">
						<h2 class="ftco-heading-2">My Accounts</h2>
						<ul class="list-unstyled">
							<li><a href="#"><span class="fa fa-chevron-right mr-2"></span>My Account</a></li>
							<li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Register</a></li>
							<li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Log In</a></li>
							<li><a href="#"><span class="fa fa-chevron-right mr-2"></span>My Order</a></li>
						</ul>
					</div>
				</div>
				<div class="col-sm-12 col-md">
					<div class="ftco-footer-widget mb-4 ml-md-4">
						<h2 class="ftco-heading-2">Information</h2>
						<ul class="list-unstyled">
							<li><a href="#"><span class="fa fa-chevron-right mr-2"></span>About us</a></li>
							<li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Catalog</a></li>
							<li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Contact us</a></li>
							<li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Term &amp; Conditions</a></li>
						</ul>
					</div>
				</div>
				<div class="col-sm-12 col-md">
					<div class="ftco-footer-widget mb-4">
						<h2 class="ftco-heading-2">Quick Link</h2>
						<ul class="list-unstyled">
							<li><a href="#"><span class="fa fa-chevron-right mr-2"></span>New User</a></li>
							<li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Help Center</a></li>
							<li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Report Spam</a></li>
							<li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Faq's</a></li>
						</ul>
					</div>
				</div>
				<div class="col-sm-12 col-md">
					<div class="ftco-footer-widget mb-4">
						<h2 class="ftco-heading-2">Have a Questions?</h2>
						<div class="block-23 mb-3">
							<ul>
								<li><span class="icon fa fa-map marker"></span><span class="text">203 Fake St. Mountain
										View, San Francisco, California, USA</span></li>
								<li><a href="#"><span class="icon fa fa-phone"></span><span class="text">+2 392 3929
											210</span></a></li>
								<li><a href="#"><span class="icon fa fa-paper-plane pr-4"></span><span
											class="text">info@yourdomain.com</span></a></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="container-fluid px-0 py-5 bg-black">
			<div class="container">
				<div class="row">
					<div class="col-md-12">

						<p class="mb-0" style="color: rgba(255,255,255,.5);">
							<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
							Copyright &copy;
							<script>document.write(new Date().getFullYear());</script> All rights reserved | This
							template is made with <i class="fa fa-heart color-danger" aria-hidden="true"></i> by <a
								href="https://colorlib.com" target="_blank">Colorlib.com</a>
							<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
						</p>
					</div>
				</div>
			</div>
		</div>
	</footer>



	<!-- loader -->
	<div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px">
			<circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee" />
			<circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10"
				stroke="#F96D00" />
		</svg></div>




</body>

</html>


<script>
	$("#checkoutForm").submit((e) => {
		e.preventDefault()
		$.ajax({
			url: '/placeOrder',
			method: 'post',
			data: $('#checkoutForm').serialize(),
			success: (response) => {
				if (response.codSuccess) {
					location.href = '/order-confirmed'
				} else {
					razorpayPayment(response)
				}
			}
		})
	})

	function razorpayPayment(order) {
		var options = {
			"key": "rzp_test_9EaiaaFVGAMGq7", // Enter the Key ID generated from the Dashboard
			"amount": order.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
			"currency": "INR",
			"name": "Liquor Store",
			"description": "Test Transaction",
			"image": "https://example.com/your_logo",
			"order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
			"handler": function (response) {

				verifyPayment(response, order)
			},
			"prefill": {
				"name": "Gaurav Kumar",
				"email": "gaurav.kumar@example.com",
				"contact": "9999999999"
			},
			"notes": {
				"address": "Razorpay Corporate Office"
			},
			"theme": {
				"color": "#3399cc"
			}
		};
		var rzp1 = new Razorpay(options);
		rzp1.open();


	}


	function verifyPayment(payment, order) {
		$.ajax({
			url: '/verify-payment',
			data: {
				payment,
				order
			},
			method: 'post',
			success: (response) => {
				if (response.status) {
					location.href = '/order-confirmed'
				} else {
					Swal.fire('Payment failed', "", 'warning')
				}
			}
		})
	}

	




</script>

<script>
	function savedAddressSelect(name, phone, buildingName, city, postcode, email) {
		document.getElementById('name').value = name
		document.getElementById('phone').value = phone
		document.getElementById('buildingName').value = buildingName
		document.getElementById('city').value = city
		document.getElementById('postcode').value = postcode
		document.getElementById('email').value = email

	}
</script>



